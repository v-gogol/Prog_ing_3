Для корректности переходов между состояниями:
1. Валидация переходов в самих состояниях — каждый метод ProcessOrder() будет проверять, можно ли выполнить переход из текущего состояния, и выбрасывать исключение или возвращать false при недопустимых переходах.
2. Матрица разрешенных переходов — создам словарь или константы с допустимыми переходами (например, "Новый" → ["В обработке", "Отменен"]), и буду проверять перед сменой состояния.
3. Методы проверки — добавлю в OrderState методы CanTransitionTo(targetState) и GetAvailableTransitions() для явной проверки допустимости переходов.
4. Конечные состояния — DeliveredState и CancelledState будут иметь пустую реализацию ProcessOrder() или возвращать ошибку при попытке дальнейшей обработки.

Дополнительные методы для управления состояниями:
1. Order.ChangeState(OrderState newState) — с проверкой допустимости перехода
2. Order.CanChangeTo(OrderState state) — проверка возможности перехода
3. Order.GetPossibleNextStates() — список доступных состояний из текущего
4. Order.Rollback() — переход к предыдущему состоянию (если логика бизнеса позволяет)